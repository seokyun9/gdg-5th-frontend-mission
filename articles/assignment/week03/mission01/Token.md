# Cookie/Session/Token

HTTP 통신은 요청->응답이 종료되면 stateless(상태유지X) 특징 때문에 연결을 끊는 방식이다.

로그인과 같이 **상태**를 기억해야하는 상황에서 '누가' 로그인 중인지 기억하기 위해 쿠키/세션/토큰을 사용한다.

HTTP는 Connectionless, Stateless 프로토콜이다.
1. Connectionless 프로토콜(비연결 지향)
클라이언트가 서버에 요청을 했을 때, 요청에 맞는 응답을 보낸 후 연결을 끊는 처리방식이다.
2. Stateless 프로토콜 (무상태 즉, 이전 상태 보존 X)
클라이언트의 상태 정보를 가지지않는 서버 처리 방식이다. 클라이언트와 첫번째 통신에 데이터를 주고 받았다 해도, 두번째 통신에 이전 데이터를 유지하지않는다.

## Cookie
    공개 가능한 정보를 사용자의 브라우저에 저장
- 서버는 응답을 작성할 때, 클라이언트 측에 저장하고 싶은 정보를 응답 헤더의 `set-cookie` 에 담는다.
- 이후 클라이언트는 재요청 할 때마다 저장된 쿠키를 요청 헤더의 `cookie` 에 담아 보낸다.
- 서버는 쿠키에 담긴 정보를 바탕으로 해당 요청의 클라이언트가 누군지 식별 할 수 있다.

### 단점
- 보안에 취약
- 용량 제한
- 브라우저마다 쿠키 지원 형태가 달라 브라우저 간 공유 불가
- 쿠키가 커질수록 네트워크에 부하가 심해짐

## Session
    클라이언트-서버 간의 특정 시간 동안의 연결 상태
    쿠키는 클라이언트 측에 정보를 저장하지만, 세션은 서버에 저장

사용자의 로그인 상태 유지를 위해 쿠키에 아이디와 비번 저장 시, 개인 소유가 아닌 컴퓨터에서 사용할 경우 개인정보가 유출된다. 또한 HTTP로 개인정보를 주고받으면 쿠키가 유출 및 조작될 수 있는 보안상 문제가 야기된다.

세션은 비밀번호와 같은 인증 정보를 쿠키에 저장하는 대신 `session id`를 이용한다.
- 서버에 사용자 정보를 `session id`를 기준으로 저장
- 서버에서 브라우저의 쿠키에 `session id` 저장
- 브라우저는 모든 request마다 `session id`를 담아 전송
- 서버는 관리 중인 id와 클라이언트로부터 받은 id를 비교하여 인증 수행

### 단점
- 서버에 저장되기 때문에 사용자가 늘어나면 유저의 정보를 찾아 데이터 매칭하는 데 오랜 시간이 걸리면서 서버에 부하가 가해진다.
- 세션 id 자체를 해커가 탈취하여 클라이언트인척 위장 가능

## Token
토큰 기반 인증 시스템은 클라이언트가 서버에 접속 시 서버에서 클라이언트에게 인증되었다는 의미로 '토큰'을 부여한다.   
    
토큰은 유일하며, 클라이언트는 서버에 요청을 보낼 때 요청 헤더에 토큰을 심어서 보낸다.   
서버는 클라이언트로부터 받은 토큰과 서버에서 제공한 토큰의 일치 여부를 체크해 인증 과정을 처리한다.

세션과 달리 서버가 아닌 **클라이언트**에 저장되며, DB나 파일에서 세션정보를 조회하는 과정이 필요없으므로 서버의 부담이 줄어든다.

앱과 서버가 통신 및 인증할 때 많이 사용된다.


    인증/인가 
    Authentication : 내가 누구인지 증명!해주는 것. (인증)
    Authorization : 음.. 너구나 ! ok 통과다 (인가)

### 토큰의 구조
토큰은 헤더(Header),페이로드(payload),서명(signature) 세 파트를 `.` 으로 구분하는 구조

### 단점
- 토큰 자체의 데이터 길이가 길어, 인증 요청이 많아질 수록 네트워크 부하가 심해질 수 있다.
- payload 자체는 암호화 x -> 유저의 중요한 정보는 담을 수 X
- 토큰을 탈취당하면 대처하기 어려움 ( 따라서 사용 기간 제한을 설정)

[참고]
[쿠키, 세션, 토큰의 차이점](https://velog.io/@jung5318/%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90)
[ JWT 토큰 인증 이란? (쿠키 vs 세션 vs 토큰)](https://inpa.tistory.com/entry/WEB-📚-JWTjson-web-token-란-💯-정리)